# 어텐션의 목표

- 입력 임베딩 벡터를 **문맥을 고려한 V 벡터로 변환**하는 것이 핵심입니다.
- **Q와 K 벡터**를 사용하여 각 단어 간의 **어텐션 점수**를 계산하고, 이를 통해 **V 벡터를 업데이트**합니다.
- 만들어진 v 벡터로 transformer 모델 등에 입력으로 넣기

# Q, K, V 벡터

- **Q와 K는 고정된 벡터**입니다. (즉, 주어진 입력 임베딩에서 선형 변환을 통해 Q와 K가 고정되고 업데이트되지 않습니다.)
- **V 벡터는 각 단어마다 문맥을 반영하여 한 번씩 업데이트**됩니다.

# 어텐션 과정 (예시: '나는 사과를 먹었다')

### 과정1: '나는'

- **"나는"**의 Q 벡터와 다른 단어들의 K 벡터를 내적하여 어텐션 점수를 계산하고, 이를 통해 **"나는"**의 V 벡터를 업데이트합니다.

### 과정2: '사과를'

- **"사과를"**의 Q 벡터와 다른 단어들의 K 벡터를 내적하여 어텐션 점수를 계산하고, 이를 통해 **"사과를"**의 V 벡터를 업데이트합니다.

### 과정3: '먹었다'

- **"먹었다"**의 Q 벡터와 다른 단어들의 K 벡터를 내적하여 어텐션 점수를 계산하고, 이를 통해 **"먹었다"**의 V 벡터를 업데이트합니다.

### 결론

- 어텐션 메커니즘에서 **V 벡터를 업데이트**하는 것은 각 단어가 문장 내 다른 단어들과 어떻게 연관되는지를 **문맥적으로 반영**하기 위함입니다.
- **Q와 K는 고정된 벡터**로 사용되며, **V 벡터는 문맥을 고려하여 각 단어마다 업데이트**됩니다.

# 계산 예시

## Q, K, V 벡터 계산 과정

### 1. Q, K, V 벡터 초기값

- "나는":
  - Q = [1, 0, 0]
  - K = [1, 1, 0]
  - V = [0.5, 0, 0]
- "사과를":
  - Q = [0, 1, 0]
  - K = [1, 0, 1]
  - V = [0, 0.5, 0]
- "먹었다":
  - Q = [0, 0, 1]
  - K = [0, 1, 1]
  - V = [0, 0, 0.5]

---

### 2. 어텐션 점수 계산

- "나는" 기준:
  - score("나는", "나는") = [1, 0, 0] · [1, 1, 0] = 1
  - score("나는", "사과를") = [1, 0, 0] · [1, 0, 1] = 1
  - score("나는", "먹었다") = [1, 0, 0] · [0, 1, 1] = 0

어텐션 점수: [1, 1, 0]

---

### 3. Softmax 계산

- Softmax 공식: Softmax(x) = exp(x) / Σ(exp(x))
- Softmax 결과:
  - Softmax(1) ≈ 0.422
  - Softmax(0) ≈ 0.156

Softmax 확률 분포: [0.422, 0.422, 0.156]

---

### 4. V 벡터 업데이트

- V*new("나는") = Softmax(1) * V("나는") + Softmax(1) \_ V("사과를") + Softmax(0) \* V("먹었다")
- 계산:

  1. Softmax(1) _ V("나는") = 0.422 _ [0.5, 0, 0] = [0.211, 0, 0]
  2. Softmax(1) _ V("사과를") = 0.422 _ [0, 0.5, 0] = [0, 0.211, 0]
  3. Softmax(0) _ V("먹었다") = 0.156 _ [0, 0, 0.5] = [0, 0, 0.078]

- 최종 V 벡터:
  V_new("나는") = [0.211, 0.211, 0.078]

---

### 5. 최종 결과

업데이트된 "나는"의 V 벡터:
V_new("나는") = [0.211, 0.211, 0.078]

### 전체 요약

- Q, K, V 벡터를 준비하고 각 단어에 대해 어텐션 점수를 계산합니다.
- 어텐션 점수는 Q와 K의 내적을 통해 구하고, 이를 **Softmax** 함수로 변환하여 확률화합니다.
- V 벡터는 이 확률에 따라 **가중합**하여 업데이트됩니다.
- 이 과정을 통해 각 단어는 **문맥을 반영한 새로운 V 벡터**를 얻게 되어, 문장의 의미를 더 잘 이해할 수 있습니다.
